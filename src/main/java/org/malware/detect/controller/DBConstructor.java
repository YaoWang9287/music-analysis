package org.malware.detect.controller;

import java.io.BufferedReader;
import java.io.FileInputStream;
import java.io.IOException;
import java.io.InputStreamReader;
import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;

import org.malware.detect.module.ConnectDB;

public class DBConstructor{
	public static void importData(String fileName){
		Connection conn=new ConnectDB().getConnection();
		if(conn==null){
			System.out.println("cannot connect to remote DB");
			return;
		}
		
		PreparedStatement preparedStatement=null;
		try {
			FileInputStream fIn = new FileInputStream(fileName);
			BufferedReader br = new BufferedReader(new InputStreamReader(fIn));
		 
			String line = null;
			while ((line = br.readLine()) != null) {
				String[] elements=line.split(":");
				for(int i=0; i<elements.length; i++)
					System.out.println(elements[i]);
				
				
		    	String sql= "INSERT INTO md5table (PESection, MD5, MalwareName)" +
		    	        "VALUES (?, ?, ?)";
		    	preparedStatement = conn.prepareStatement(sql);
		    	preparedStatement.setString(1, elements[0]);
		    	preparedStatement.setString(2, elements[1]);
		    	preparedStatement.setString(3, elements[2]);
		    	preparedStatement.executeUpdate(); 
			}
			
			br.close();
		}catch (IOException e){
			e.printStackTrace();
		}catch(SQLException ex){
			ex.printStackTrace();
		}finally{      
			try {
				if(preparedStatement!=null)
					preparedStatement.close();
			} catch (SQLException e) {
				e.printStackTrace();
			}
    		try {
    			if(conn!=null)
    				conn.close();
			} catch (SQLException e) {
				e.printStackTrace();
			}
		}
	}
	
	public static void main(String[] arg){
		DBConstructor.importData("C:\\Users\\Pengcheng\\Desktop\\main.mdb");
	}
}
