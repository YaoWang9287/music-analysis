package org.malware.detect.controller;

import java.io.FileInputStream;
import java.io.IOException;
import java.io.PrintWriter;

import javax.servlet.*;
import javax.servlet.http.*;

import org.json.JSONObject;
import org.malware.detect.module.DownloadHandler;
import org.malware.detect.module.MD5;

public class requestListener extends HttpServlet {

	protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException { 
		PrintWriter Out = response.getWriter();
		response.setContentType("application/json"); 
		JSONObject json=new JSONObject();
		
		String fileURL= request.getParameter("fileURL");
		if(fileURL==null || fileURL==""){
			json.accumulate("message", "URL cannot be null!");
			json.accumulate("status", "1");
		}else{
			long startTime = System.currentTimeMillis();
	    	
	    	String file=DownloadHandler.download(fileURL);
	    	FileInputStream fis=MD5.fileFetcher(file);
			String result=MD5.checkfor(fis);  
			
			json.accumulate("MD5 checking", result==null?"No virus detected!":result);
			json.accumulate("message", "Good");
			json.accumulate("status", "0");
			
			long estimatedTime = System.currentTimeMillis() - startTime;
			System.out.println(estimatedTime/1000+"s taken to detect the virus!");
		}
			
		
		
		Out.println(json);
	}	
}
