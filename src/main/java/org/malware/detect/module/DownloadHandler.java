package org.malware.detect.module;

import java.io.BufferedInputStream;
import java.io.ByteArrayOutputStream;
import java.io.FileOutputStream;
import java.io.InputStream;
import java.net.MalformedURLException;
import java.net.URL;


public class DownloadHandler {
	public static String download(String url){
		
		String fileName = "C:/WPC/GitHub/malwareD/file"+System.currentTimeMillis()+".txt"; 
		URL link=null;
		
		/*URL test:*/
		try {
			link = new URL(url);
		} catch (MalformedURLException e) {
			System.out.println("the URL is invalid");
			//json.accumulate("info", "the URL is invalid!");
			return "failed to make the URL";
		}
		
		try{
			InputStream in = new BufferedInputStream(link.openStream());
			ByteArrayOutputStream out = new ByteArrayOutputStream();
			byte[] buf = new byte[1024];
			int n = 0;
			while (-1!=(n=in.read(buf))){
				out.write(buf, 0, n);
			}
			out.close();
			in.close();
			byte[] byteArr = out.toByteArray();

			FileOutputStream fos = new FileOutputStream(fileName);
			fos.write(byteArr);
			fos.close();
			//json.accumulate("info", "Succeed to download!!");
		}catch(Exception ex){
			//json.accumulate("info", "Failed to download the file!");
			return "fail to download the file";
		}
        return fileName;
	}
}
